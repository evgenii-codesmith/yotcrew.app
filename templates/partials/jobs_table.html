<!-- Enhanced Job Cards Grid with Alpine.js -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4" 
     x-data="jobGrid()">
    {% for job in jobs %}
    <!-- Interactive Job Card -->
    <div class="card bg-base-100 w-full shadow-sm hover:shadow-lg transition-all duration-300"
         x-data="jobCard({{ job.id }}, '{{ job.title }}', `{{ job.description|replace('`', '') if job.description else '' }}`)"
         :class="{ 'ring-2 ring-primary': selected, 'bg-base-200': saved }">
        
        <!-- Card Header with Select Checkbox -->
        <div class="absolute top-2 right-2 z-10 flex gap-2">
            <input type="checkbox" 
                   x-model="selected"
                   @change="updateSelection({{ job.id }}, $event.target.checked)"
                   class="checkbox checkbox-primary checkbox-sm bg-white shadow-md"
                   title="Select for comparison">
            
            <button @click="toggleSaved()" 
                    :class="saved ? 'text-red-500' : 'text-gray-400'"
                    class="btn btn-circle btn-xs bg-white shadow-md hover:bg-gray-100"
                    :title="saved ? 'Remove from saved' : 'Save job'">
                <span x-text="saved ? '‚ù§Ô∏è' : 'ü§ç'"></span>
            </button>
        </div>
        
        <figure @click="toggleExpanded()" class="cursor-pointer relative overflow-hidden">
            <img :src="cardYachtImage.url" 
                 :alt="cardYachtImage.alt"
                 class="w-full h-48 object-cover transition-all duration-300"
                 :class="{ 'scale-105': expanded }" />
            <!-- Yacht image refresh button -->
            <button @click.stop="refreshYachtImage()" 
                    class="absolute bottom-2 right-2 btn btn-circle btn-xs bg-white/80 hover:bg-white opacity-70 hover:opacity-100 transition-all"
                    title="New yacht image">
                üé≤
            </button>
            <!-- Image overlay with yacht name -->
            <div class="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
                <span x-text="cardYachtImage.alt"></span>
            </div>
        </figure>
        
        <div class="card-body p-4">
            <h2 class="card-title text-lg font-bold line-clamp-2 cursor-pointer"
                @click="toggleExpanded()">
                {{ job.title }}
                <span x-show="expanded" class="text-primary">üìñ</span>
            </h2>
            
            {% if job.company %}
            <p class="text-sm text-base-content/70 font-medium">{{ job.company }}</p>
            {% endif %}
            
            <!-- Expandable Description -->
            <div>
                {% if job.description %}
                <p class="text-sm text-base-content/80 my-2"
                   :class="expanded ? '' : 'line-clamp-3'">
                    {% if job.description|length > 100 %}
                        <span x-show="!expanded">{{ job.description[:100] }}...</span>
                        <span x-show="expanded">{{ job.description }}</span>
                    {% else %}
                        {{ job.description }}
                    {% endif %}
                </p>
                
                {% if job.description|length > 100 %}
                <button @click="toggleExpanded()" 
                        class="text-primary text-xs hover:underline">
                    <span x-text="expanded ? 'Show Less' : 'Show More'"></span>
                </button>
                {% endif %}
                {% endif %}
            </div>
            
            <!-- Badges -->
            <div class="flex flex-wrap gap-1 my-2">
                {% if job.location %}
                <div class="badge badge-outline badge-sm">
                    {{ job.location }}
                </div>
                {% endif %}
                
                {% if job.salary_range or job.salary %}
                <div class="badge badge-success badge-sm">
                    {{ job.salary_range or job.salary }}
                </div>
                {% endif %}
                
                {% if job.job_type %}
                <div class="badge badge-primary badge-sm">
                    {{ job.job_type }}
                </div>
                {% endif %}
                
                <!-- Source badge -->
                {% if job.source %}
                <div class="badge badge-secondary badge-sm">
                    {{ job.source }}
                </div>
                {% endif %}
            </div>
            
            <!-- Actions -->
            <div class="card-actions justify-between mt-4">
                <div class="flex gap-2">
                    {% if job.source_url or job.url %}
                    <a href="{{ job.source_url or job.url }}" target="_blank" 
                       class="btn btn-primary btn-sm"
                       @click.stop>
                        Apply
                    </a>
                    {% endif %}
                    <button class="btn btn-outline btn-sm" 
                            hx-get="/htmx/job-card/{{ job.id }}" 
                            hx-target="#job-modal-content"
                            @click.stop>
                        Details
                    </button>
                </div>
                
                <!-- Quick Actions -->
                <div class="flex gap-1">
                    <button @click.stop="copyJobLink()" 
                            class="btn btn-ghost btn-xs"
                            title="Copy job link">
                        üìã
                    </button>
                    <button @click.stop="shareJob()" 
                            class="btn btn-ghost btn-xs"
                            title="Share job">
                        üì§
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    <!-- Floating Comparison Panel -->
    <div x-show="selectedJobs.length > 0" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="transform translate-y-full"
         x-transition:enter-end="transform translate-y-0"
         class="fixed bottom-4 right-4 z-50">
        <div class="bg-primary text-primary-content p-4 rounded-lg shadow-xl">
            <div class="flex items-center gap-3">
                <span x-text="`${selectedJobs.length} jobs selected`" class="font-medium"></span>
                
                <button @click="compareJobs()" 
                        x-show="selectedJobs.length >= 2"
                        class="btn btn-secondary btn-sm">
                    Compare Jobs
                </button>
                
                <button @click="clearSelection()" 
                        class="btn btn-ghost btn-sm">
                    Clear
                </button>
            </div>
        </div>
    </div>
</div>

{% if not jobs %}
<!-- No Jobs State -->
<div class="flex flex-col items-center justify-center py-20">
    <div class="text-6xl mb-4">üõ•Ô∏è</div>
    <h3 class="text-xl font-bold mb-2">No Jobs Found</h3>
    <p class="text-base-content/70">Try refreshing or check back later</p>
</div>
{% endif %}

<!-- Job Detail Modal -->
<dialog id="job-modal" class="modal">
    <div class="modal-box max-w-4xl">
        <div id="job-modal-content">
            <!-- Job details will be loaded here -->
        </div>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn">Close</button>
            </form>
        </div>
    </div>
</dialog>

<script>
    // Job Grid Component
    function jobGrid() {
        return {
            selectedJobs: [],
            
            // Yacht images collection
            yachtImages: [
                {
                    id: 1,
                    url: "https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=200&fit=crop&crop=center",
                    alt: "Luxury Motor Yacht"
                },
                {
                    id: 2,
                    url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=200&fit=crop&crop=center",
                    alt: "Superyacht in Harbor"
                },
                {
                    id: 3,
                    url: "https://images.unsplash.com/photo-1582967788606-a171c1080cb0?w=400&h=200&fit=crop&crop=center",
                    alt: "Modern Sailing Yacht"
                },
                {
                    id: 4,
                    url: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=200&fit=crop&crop=center",
                    alt: "Explorer Yacht"
                },
                {
                    id: 5,
                    url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=200&fit=crop&crop=center",
                    alt: "Catamaran Superyacht"
                },
                {
                    id: 6,
                    url: "https://images.unsplash.com/photo-1615781222256-cd404c71eb9e?w=400&h=200&fit=crop&crop=center",
                    alt: "Mega Yacht at Sunset"
                },
                {
                    id: 7,
                    url: "https://images.unsplash.com/photo-1566576912321-d58ddd7a6088?w=400&h=200&fit=crop&crop=center",
                    alt: "Classic Motor Yacht"
                },
                {
                    id: 8,
                    url: "https://images.unsplash.com/photo-1500917293891-ef795e70e1f6?w=400&h=200&fit=crop&crop=center",
                    alt: "Sailing Superyacht"
                },
                {
                    id: 9,
                    url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=200&fit=crop&crop=center",
                    alt: "Luxury Charter Yacht"
                },
                {
                    id: 10,
                    url: "https://images.unsplash.com/photo-1517101216274-0a676e44e4bd?w=400&h=200&fit=crop&crop=center",
                    alt: "Sport Fishing Yacht"
                },
                {
                    id: 11,
                    url: "https://images.unsplash.com/photo-1615781222256-cd404c71eb9e?w=400&h=200&fit=crop&crop=center",
                    alt: "Mediterranean Superyacht"
                },
                {
                    id: 12,
                    url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop&crop=center",
                    alt: "Ocean Explorer"
                },
                {
                    id: 13,
                    url: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=200&fit=crop&crop=center",
                    alt: "Modern Expedition Yacht"
                },
                {
                    id: 14,
                    url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=200&fit=crop&crop=center",
                    alt: "Luxury Motor Yacht"
                },
                {
                    id: 15,
                    url: "https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=400&h=200&fit=crop&crop=center",
                    alt: "Racing Yacht"
                },
                {
                    id: 16,
                    url: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=200&fit=crop&crop=center",
                    alt: "Charter Superyacht"
                },
                {
                    id: 17,
                    url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=200&fit=crop&crop=center",
                    alt: "Twin Hull Catamaran"
                },
                {
                    id: 18,
                    url: "https://images.unsplash.com/photo-1615781222256-cd404c71eb9e?w=400&h=200&fit=crop&crop=center",
                    alt: "Sunset Cruiser"
                },
                {
                    id: 19,
                    url: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=200&fit=crop&crop=center",
                    alt: "Ocean Liner Style Yacht"
                },
                {
                    id: 20,
                    url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=200&fit=crop&crop=center",
                    alt: "High-Speed Motor Yacht"
                },
                {
                    id: 21,
                    url: "https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=200&fit=crop&crop=center",
                    alt: "Flybridge Motor Yacht"
                },
                {
                    id: 22,
                    url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop&crop=center",
                    alt: "Explorer Superyacht"
                },
                {
                    id: 23,
                    url: "https://images.unsplash.com/photo-1517101216274-0a676e44e4bd?w=400&h=200&fit=crop&crop=center",
                    alt: "Sport Yacht"
                },
                {
                    id: 24,
                    url: "https://images.unsplash.com/photo-1559827260-dc66d52bef19?w=400&h=200&fit=crop&crop=center",
                    alt: "Mega Yacht"
                },
                {
                    id: 25,
                    url: "https://images.unsplash.com/photo-1615781222256-cd404c71eb9e?w=400&h=200&fit=crop&crop=center",
                    alt: "Luxury Charter Vessel"
                },
                {
                    id: 26,
                    url: "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=400&h=200&fit=crop&crop=center",
                    alt: "High-Performance Yacht"
                },
                {
                    id: 27,
                    url: "https://images.unsplash.com/photo-1500917293891-ef795e70e1f6?w=400&h=200&fit=crop&crop=center",
                    alt: "Classic Sailing Yacht"
                },
                {
                    id: 28,
                    url: "https://images.unsplash.com/photo-1567899378494-47b22a2ae96a?w=400&h=200&fit=crop&crop=center",
                    alt: "Performance Cruiser"
                },
                {
                    id: 29,
                    url: "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=200&fit=crop&crop=center",
                    alt: "Long Range Explorer"
                },
                {
                    id: 30,
                    url: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=400&h=200&fit=crop&crop=center",
                    alt: "Ultimate Superyacht"
                }
            ],
            
            getRandomYachtImage() {
                const randomIndex = Math.floor(Math.random() * this.yachtImages.length);
                return this.yachtImages[randomIndex];
            },
            
            updateSelection(jobId, isSelected) {
                if (isSelected) {
                    if (!this.selectedJobs.includes(jobId)) {
                        this.selectedJobs.push(jobId);
                    }
                } else {
                    this.selectedJobs = this.selectedJobs.filter(id => id !== jobId);
                }
            },
            
            clearSelection() {
                this.selectedJobs = [];
                // Clear all checkboxes
                document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            },
            
            compareJobs() {
                alert(`Comparing ${this.selectedJobs.length} jobs: ${this.selectedJobs.join(', ')}`);
            }
        }
    }
    
    // Individual Job Card Component
    function jobCard(jobId, jobTitle, jobDescription) {
        return {
            id: jobId,
            title: jobTitle,
            description: jobDescription,
            expanded: false,
            selected: false,
            saved: false,
            cardYachtImage: {},
            
            init() {
                // Get random yacht image for this card
                this.refreshYachtImage();
            },
            
            refreshYachtImage() {
                // Get random yacht image from parent component
                const parent = this.$parent;
                if (parent && parent.getRandomYachtImage) {
                    this.cardYachtImage = parent.getRandomYachtImage();
                }
            },
            
            toggleExpanded() {
                this.expanded = !this.expanded;
            },
            
            toggleSaved() {
                this.saved = !this.saved;
                // You could add localStorage persistence here
                console.log(`Job ${this.id} ${this.saved ? 'saved' : 'unsaved'}`);
            },
            
            copyJobLink() {
                const url = `${window.location.origin}/jobs/${this.id}`;
                navigator.clipboard.writeText(url).then(() => {
                    // You could show a toast notification here
                    console.log('Job link copied!');
                });
            },
            
            shareJob() {
                if (navigator.share) {
                    navigator.share({
                        title: this.title,
                        text: this.description.substring(0, 100) + '...',
                        url: `${window.location.origin}/jobs/${this.id}`
                    });
                } else {
                    // Fallback to copy link
                    this.copyJobLink();
                }
            }
        }
    }
</script> 