<!-- Enhanced Job Cards Grid with Alpine.js -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 p-4" 
     x-data="jobGrid()">
    {% for job in jobs %}
    <!-- Interactive Job Card -->
    <div class="card bg-base-100 w-full shadow-sm hover:shadow-lg transition-all duration-300"
         x-data="jobCard('{{ job.id }}', '{{ job.title }}', `{{ job.description|replace('`', '') if job.description else '' }}`)"
         :class="{ 'ring-2 ring-primary': selected, 'bg-base-200': saved }">
        
        <!-- Card Header with Select Checkbox -->
        <div class="absolute top-2 right-2 z-10 flex gap-2">
            <input type="checkbox" 
                   x-model="selected"
                   @change="updateSelection('{{ job.id }}', $event.target.checked)"
                   class="checkbox checkbox-primary checkbox-sm bg-white shadow-md"
                   title="Select for comparison">
            
            <button @click="toggleSaved()" 
                    :class="saved ? 'text-red-500' : 'text-gray-400'"
                    class="btn btn-circle btn-xs bg-white shadow-md hover:bg-gray-100"
                    :title="saved ? 'Remove from saved' : 'Save job'">
                <span x-text="saved ? '‚ù§Ô∏è' : 'ü§ç'"></span>
            </button>
        </div>
        
        <figure @click="toggleExpanded()" class="cursor-pointer relative overflow-hidden">
            <img :src="cardYachtImage.url || 'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=400&h=200&fit=crop&crop=center'" 
                 :alt="cardYachtImage.alt || 'Luxury Yacht'"
                 class="w-full h-48 object-cover transition-all duration-300"
                 :class="{ 'scale-105': expanded }"
                 @error="handleImageError()"
                 loading="lazy" />
            <!-- Yacht image refresh button -->
            <button @click.stop="refreshYachtImage()" 
                    class="absolute bottom-2 right-2 btn btn-circle btn-xs bg-white/80 hover:bg-white opacity-70 hover:opacity-100 transition-all"
                    title="New yacht image">
                üé≤
            </button>
            <!-- Image overlay with yacht name -->
            <div class="absolute bottom-2 left-2 bg-black/50 text-white text-xs px-2 py-1 rounded backdrop-blur-sm">
                <span x-text="cardYachtImage.alt || 'Luxury Yacht'"></span>
            </div>
        </figure>
        
        <div class="card-body p-4">
            <h2 class="card-title text-lg font-bold line-clamp-2 cursor-pointer"
                @click="toggleExpanded()">
                {{ job.title }}
                <span x-show="expanded" class="text-primary">üìñ</span>
            </h2>
            
            {% if job.company %}
            <p class="text-sm text-base-content/70 font-medium">{{ job.company }}</p>
            {% endif %}
            
            <!-- Expandable Description -->
            <div>
                {% if job.description %}
                <p class="text-sm text-base-content/80 my-2"
                   :class="expanded ? '' : 'line-clamp-3'">
                    {% if job.description|length > 100 %}
                        <span x-show="!expanded">{{ job.description[:100] }}...</span>
                        <span x-show="expanded">{{ job.description }}</span>
                    {% else %}
                        {{ job.description }}
                    {% endif %}
                </p>
                
                {% if job.description|length > 100 %}
                <button @click="toggleExpanded()" 
                        class="text-primary text-xs hover:underline">
                    <span x-text="expanded ? 'Show Less' : 'Show More'"></span>
                </button>
                {% endif %}
                {% endif %}
            </div>
            
            <!-- Badges -->
            <div class="flex flex-wrap gap-1 my-2">
                {% if job.location %}
                <div class="badge badge-outline badge-sm">
                    {{ job.location }}
                </div>
                {% endif %}
                
                {% if job.salary_range or job.salary %}
                <div class="badge badge-success badge-sm">
                    {{ job.salary_range or job.salary }}
                </div>
                {% endif %}
                
                {% if job.job_type %}
                <div class="badge badge-primary badge-sm">
                    {{ job.job_type }}
                </div>
                {% endif %}
                
                <!-- Source badge -->
                {% if job.source %}
                <div class="badge badge-secondary badge-sm">
                    {{ job.source }}
                </div>
                {% endif %}
            </div>
            
            <!-- Actions -->
            <div class="card-actions justify-between mt-4">
                <div class="flex gap-2">
                    {% if job.source_url or job.url %}
                    <a href="{{ job.source_url or job.url }}" target="_blank" 
                       class="btn btn-primary btn-sm"
                       @click.stop>
                        Apply
                    </a>
                    {% endif %}
                    <button class="btn btn-outline btn-sm" 
                            hx-get="/htmx/job-card/{{ job.id }}" 
                            hx-target="#job-modal-content"
                            @click.stop>
                        Details
                    </button>
                </div>
                
                <!-- Quick Actions -->
                <div class="flex gap-1">
                    <button @click.stop="copyJobLink()" 
                            class="btn btn-ghost btn-xs"
                            title="Copy job link">
                        üìã
                    </button>
                    <button @click.stop="shareJob()" 
                            class="btn btn-ghost btn-xs"
                            title="Share job">
                        üì§
                    </button>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
    
    <!-- Floating Comparison Panel -->
    <div x-show="selectedJobs.length > 0" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="transform translate-y-full"
         x-transition:enter-end="transform translate-y-0"
         class="fixed bottom-4 right-4 z-50">
        <div class="bg-primary text-primary-content p-4 rounded-lg shadow-xl">
            <div class="flex items-center gap-3">
                <span x-text="`${selectedJobs.length} jobs selected`" class="font-medium"></span>
                
                <button @click="compareJobs()" 
                        x-show="selectedJobs.length >= 2"
                        class="btn btn-secondary btn-sm">
                    Compare Jobs
                </button>
                
                <button @click="clearSelection()" 
                        class="btn btn-ghost btn-sm">
                    Clear
                </button>
            </div>
        </div>
    </div>
</div>

{% if not jobs %}
<!-- No Jobs State -->
<div class="flex flex-col items-center justify-center py-20">
    <div class="text-6xl mb-4">üõ•Ô∏è</div>
    <h3 class="text-xl font-bold mb-2">No Jobs Found</h3>
    <p class="text-base-content/70">Try refreshing or check back later</p>
</div>
{% endif %}

<!-- Job Detail Modal -->
<dialog id="job-modal" class="modal">
    <div class="modal-box max-w-4xl">
        <div id="job-modal-content">
            <!-- Job details will be loaded here -->
        </div>
        <div class="modal-action">
            <form method="dialog">
                <button class="btn">Close</button>
            </form>
        </div>
    </div>
</dialog> 